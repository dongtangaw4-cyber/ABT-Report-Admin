<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<title>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ | ABT Report</title>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  body{font-family:'Kanit',sans-serif;margin:0;background:url('Background‡∏ò‡∏µ‡∏°.png') center/cover no-repeat fixed}
  #btnBack{position:fixed;top:20px;left:20px;background:#16a34a;color:#fff;border:0;padding:10px 16px;border-radius:8px;box-shadow:0 4px 10px rgba(0,0,0,.15);cursor:pointer}
  .wrap{max-width:720px;margin:120px auto;background:rgba(255,255,255,.92);backdrop-filter:blur(10px);border-radius:16px;padding:20px}
  h2{ text-align:center; font-weight:700; font-size:26px; margin:0 0 20px; color:#0f172a }
  .row{display:flex;gap:10px}
  input{flex:1;padding:10px;border-radius:8px;border:1px solid #ccc}
  button{padding:10px 16px;border:0;border-radius:8px;background:#16a34a;color:#fff;cursor:pointer}

  .item{display:flex;gap:14px;align-items:flex-start;background:rgba(255,255,255,.98);margin:12px 0;padding:12px;border-radius:12px;box-shadow:0 4px 16px rgba(0,0,0,.10)}
  .thumb{width:120px;height:90px;object-fit:cover;border-radius:10px;box-shadow:0 3px 10px rgba(0,0,0,.15)}
  .text{flex:1;min-width:0}
  .muted{color:#64748b}
  .pill{padding:3px 8px;border-radius:10px;font-size:12px}
  .s-‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß{background:#e0f2fe;color:#0369a1}
  .s-‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£{background:#fef9c3;color:#854d0e}
  .s-‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô{background:#dcfce7;color:#166534}
  .warn-text{color:#dc2626;font-weight:700;margin:6px 0 10px}
  .blue{color:#0b3aa5}

  /* ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ã‡πâ‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏£‡∏π‡∏õ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏•‡∏≤‡∏á‡∏û‡∏≠‡∏î‡∏µ */
  .item .left{width:260px;min-height:100px;display:flex;align-items:center;justify-content:center}
  .photos{display:flex;justify-content:center;align-items:center;gap:12px;flex-wrap:wrap}
  .ph{position:relative;display:inline-block}
  .ph .tag{position:absolute;left:6px;bottom:6px;font-size:11px;line-height:1;padding:4px 6px;border-radius:8px;color:#fff;background:rgba(0,0,0,.55);backdrop-filter:blur(4px)}

  /* ‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á ‚Äú‡∏£‡∏≠‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏á‚Äù */
  .thumb.placeholder{display:flex;align-items:center;justify-content:center;background:#eef6ff;color:#3b82f6;border:1px dashed #93c5fd}

  /* ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
  @media (max-width:680px){
    .wrap{margin:90px 12px}
    .item{flex-direction:column}
    .item .left{width:100%}
    .thumb{width:46vw;max-width:180px;height:auto;aspect-ratio:4/3}
  }
</style>
</head>
<body>
<button id="btnBack">‚¨ÖÔ∏è ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>

<div class="wrap">
  <h2>üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤</h2>
  <div class="warn-text">**‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏î‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤**</div>

  <div class="row">
    <input id="q" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ ‡∏´‡∏£‡∏∑‡∏≠ 4 ‡∏ï‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢">
    <button id="btnSearch">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
  </div>

  <div id="result" style="margin-top:10px"></div>
</div>

<!-- ‡πÉ‡∏ä‡πâ compat SDK ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ô‡∏ö‡∏ô file:// ‡πÑ‡∏î‡πâ -->
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>

<script>
  // ===== Firebase =====
  const firebaseConfig = {
    apiKey: "AIzaSyDR8hVqZ1uDrjRMjK6u_rWO6c7Cs5-vDXw",
    authDomain: "abt-report.firebaseapp.com",
    projectId: "abt-report",
    storageBucket: "abt-report.appspot.com",
    messagingSenderId: "166748459797",
    appId: "1:166748459797:web:0cf5693e43a551142a8f1c"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  firebase.auth().signInAnonymously();

  // ===== UI =====
  const resBox = document.getElementById('result');
  document.getElementById('btnBack').onclick = () => history.length>1 ? history.back() : (location='index.html');

  const fmt = t => (t && typeof t.toDate==='function')
    ? t.toDate().toLocaleString('th-TH',{year:'numeric',month:'short',day:'2-digit',hour:'2-digit',minute:'2-digit'})
    : '-';

  async function search(){
    const q = document.getElementById('q').value.trim().replace(/\D/g,'');
    if(!q){ alert('‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£'); return; }

    resBox.innerHTML = '<div class="muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...</div>';
    try{
      let list=[];
      if(q.length>=9){
        const snap = await db.collection('reports')
          .where('phone','==',q).orderBy('createdAt','desc').limit(50).get();
        list = snap.docs.map(d=>d.data());
      }else{
        const snap = await db.collection('reports')
          .orderBy('createdAt','desc').limit(80).get();
        list = snap.docs.map(d=>d.data()).filter(r=>(r.phone||'').endsWith(q));
      }
      if(!list.length){ resBox.innerHTML='<div class="muted">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>'; return; }

      resBox.innerHTML = list.map(r => (
        '<div class="item">'
          + '<div class="left"><div class="photos">'
              + (r.photo
                  ? '<a href="'+r.photo+'" target="_blank" rel="noopener" class="ph">'
                      + '<img class="thumb" loading="lazy" src="'+r.photo+'" alt="‡∏Å‡πà‡∏≠‡∏ô"><span class="tag">‡∏Å‡πà‡∏≠‡∏ô</span>'
                    + '</a>'
                  : '<div class="thumb placeholder">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ</div>')
              + (r.photoAfter
                  ? '<a href="'+r.photoAfter+'" target="_blank" rel="noopener" class="ph">'
                      + '<img class="thumb" loading="lazy" src="'+r.photoAfter+'" alt="‡∏´‡∏•‡∏±‡∏á"><span class="tag">‡∏´‡∏•‡∏±‡∏á</span>'
                    + '</a>'
                  : (r.status==='‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô'
                      ? '<div class="thumb placeholder">‡∏£‡∏≠‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏á</div>'
                      : '')
                )
            + '</div></div>'
          + '<div class="text">'
              + '<div class="muted" style="font-size:13px;margin-bottom:4px;">üïí '+fmt(r.createdAt)+'</div>'
              + '<div><b>‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á:</b> <span class="blue">'+(r.name||'-')+'</span></div>'
              + (r.phone ? '<div><b>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</b> <span class="blue">'+r.phone+'</span></div>' : '')
              + '<b>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</b> <span class="blue">'+(r.category||'-')+'</span><br>'
              + '<b>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</b> <span class="blue">'+(r.detail||'-')+'</span><br>'
              + '<b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</b> <span class="blue"><span class="pill s-'+(r.status||'‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß')+'">'+(r.status||'‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß')+'</span></span><br>'
              + (r.lat ? '<div class="muted">‡∏û‡∏¥‡∏Å‡∏±‡∏î: '+r.lat+', '+r.lng+' ¬∑ <a href="https://maps.google.com/?q='+r.lat+','+r.lng+'" target="_blank">‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</a></div>' : '')
            + '</div>'
        + '</div>'
      )).join('');
    }catch(e){
      console.error(e);
      resBox.innerHTML='<div class="muted">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: '+e.message+'</div>';
    }
  }

  document.getElementById('btnSearch').onclick = search;
  document.getElementById('q').onkeydown = e => { if(e.key==='Enter') search(); };
</script>
</body>
</html>